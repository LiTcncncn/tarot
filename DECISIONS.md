# Tarot Mirror - 产品决策记录

本文档记录产品开发过程中的关键决策，便于团队对齐和后续参考。

---

## 🎯 核心差异化（已确认）

**决策日期**：2024-XX-XX

**决策内容**：
**每日塔罗 + 月相综合分析**，结合轻疗愈，形成每日运势和建议，形成日历后有周总结和月总结。

**核心要点**：
- 结合塔罗牌和月相能量，提供更全面的每日运势分析
- 从占卜到治愈任务到情绪反馈的完整闭环
- 通过日历、周总结、月总结形成长期使用习惯和成长轨迹

**影响范围**：
- 每日运势功能需要集成月相数据
- 周/月总结需要包含月相分析
- UI设计需要展示月相信息

---

## 🔮 多占卜师系统技术方案（已确认）

**决策日期**：2024-XX-XX

**决策内容**：
使用 DeepSeek、ChatGPT、Gemini 等 LLM，各自调用 API key，并用 prompt 来定义不同塔罗师。

**技术实现**：
- **DeepSeek API**：一个占卜师
- **ChatGPT API (OpenAI)**：一个占卜师
- **Gemini API (Google)**：一个占卜师
- 每个 LLM 使用不同的 prompt 模板定义占卜师人设和解读风格

**影响范围**：
- 后端需要集成多个 LLM API
- 需要设计不同占卜师的 prompt 模板
- 需要管理多个 API key 和成本

---

## 🔮 多占卜师对比功能（已确认）

**决策日期**：2024-XX-XX

**决策内容**：
**第一版可以没有**多占卜师对比功能。

**后续规划**：
- 后续版本可考虑添加此功能
- 帮助用户从不同角度理解同一牌阵

**影响范围**：
- MVP 阶段不包含此功能
- 简化第一版开发复杂度

---

## 🔑 API 配置（已确认）

**决策日期**：2024-XX-XX

**决策内容**：
Demo 阶段使用 DeepSeek API，API Key 已配置。

**技术实现**：
- 使用环境变量管理 API Key（.env 文件）
- 配置文件已创建（见 `API_CONFIG.md`）
- 占卜师人设：Luna（温柔型）

**安全措施**：
- .env 文件已添加到 .gitignore
- 创建了 .env.example 作为模板
- 生产环境需使用后端代理或密钥管理服务

---

## 🌐 Web Demo 技术方案（已实现）

**决策日期**：2024-XX-XX

**决策内容**：
使用 Web 技术栈（HTML + CSS + JavaScript）构建 Demo 版本，用于逻辑和可行性验证。

**技术实现**：
- **前端**：纯 HTML/CSS/JavaScript，无框架依赖
- **部署**：静态文件服务器（可直接部署到任何静态托管服务）
- **适配**：支持 PC 和移动端（16:9 比例）

**文件结构**：
```
demo/
├── index.html          # 主页面
├── css/style.css      # 样式文件
├── js/
│   ├── api.js         # DeepSeek API 调用
│   ├── main.js        # 主逻辑入口
│   ├── ui.js          # UI 交互逻辑
│   ├── tarot-cards.js # 塔罗牌数据和抽取逻辑
│   ├── moon-phase.js  # 月相计算
│   └── storage.js     # 本地存储（localStorage）
└── Cards-png/         # 塔罗牌图片资源（79张）
```

**影响范围**：
- 便于快速验证核心逻辑
- 可直接部署到静态服务器
- 后续可迁移到 Flutter 应用

---

## 🌙 月相计算方案（已实现）

**决策日期**：2024-XX-XX

**决策内容**：
使用本地计算方式获取月相数据，不依赖第三方 API。

**技术实现**：
- **算法**：基于 Julian Day 算法计算月相
- **实现**：JavaScript 客户端计算（见 `demo/js/moon-phase.js`）
- **精度**：满足日常使用需求

**优势**：
- ✅ 无需 API 调用，降低成本
- ✅ 离线可用
- ✅ 隐私保护（不发送位置信息）
- ✅ 响应速度快

**月相类型**：
- 新月（New Moon）
- 上弦月（First Quarter）
- 满月（Full Moon）
- 下弦月（Last Quarter）
- 以及中间过渡阶段

**影响范围**：
- 每日自动计算月相
- 结合塔罗牌进行综合分析
- 周/月总结中包含月相周期回顾

---

## 🎴 塔罗牌抽取逻辑（已实现）

**决策日期**：2024-XX-XX

**决策内容**：
塔罗牌抽取采用完全随机方式，支持正位和逆位。

**技术实现**：
- **牌库**：78张标准塔罗牌（22张大阿卡纳 + 56张小阿卡纳）
- **抽取方式**：`Math.random()` 完全随机
- **正逆位**：50% 概率为逆位，逆位时图片旋转 180 度显示
- **显示位置**：抽牌界面、Loading 界面、主界面

**关键特性**：
- ✅ 每次抽取都是独立的随机事件
- ✅ 支持重置后重新抽取（不基于日期种子）
- ✅ 逆位牌在所有界面正确倒置显示

**影响范围**：
- 用户体验：每次占卜结果不同
- UI 实现：需要处理逆位旋转逻辑
- 数据存储：需要记录正逆位状态

---

## 🎨 UI/UX 设计决策（已实现）

**决策日期**：2024-XX-XX

### 三页面流程
**决策内容**：将每日占卜流程分为三个独立的全屏页面。

**页面结构**：
1. **页面1：每日占卜页面**
   - 情绪状态选择（5档按钮式）
   - 塔罗牌抽取（支持点击和长按）
   - 动态背景色（基于情绪状态的莫兰迪色系渐变）

2. **页面2：Loading 页面**
   - 显示抽到的塔罗牌（逆位时倒置）
   - 生成中动画和提示文字

3. **页面3：主界面**
   - 月相和塔罗牌并排显示
   - 今日指引（粗黑文字，左对齐）
   - 今日分析（200字详细分析）
   - 疗愈任务（可完成）
   - 分类指引（5个领域，展开/折叠）
   - 幸运元素（颜色、饰品、数字、摆件）
   - 重新占卜按钮（左上角）

### 情绪选择方式
**决策内容**：使用5档按钮式选择器，替代滑动条。

**实现细节**：
- 5个情绪状态：愉悦、平静、疲惫、迷茫、焦虑
- 默认选择：平静
- 按钮式交互，点击即可选择
- 选择后背景色渐变到对应情绪的颜色

### 配色方案
**决策内容**：统一使用基于 #6D5C5C 的色系，只做深浅变化。

**色系定义**：
- 基色：`#6D5C5C`
- 浅色：`#B5A8A8`, `#E5E0E0`, `#F5F3F3`
- 深色：`#4D4040`, `#2D2525`, `#1A1515`

**应用范围**：
- 所有卡片背景
- 按钮和交互元素
- 文字颜色（基于色系的深色）
- 不出现其他色相

### 背景色动态变化
**决策内容**：根据选择的情绪状态，背景色渐变到对应的莫兰迪色系。

**实现细节**：
- 5种情绪对应5种颜色渐变
- 从左到右：鲜亮 → 灰暗（愉悦 → 焦虑）
- 过渡时间：10秒平滑渐变
- 使用 CSS `transition` 和 JavaScript 动态设置

### 响应式设计
**决策内容**：以 1330px 为断点，区分大屏版和移动端。

**断点规则**：
- **大屏版**：宽度 ≥ 1330px
  - 两列网格布局
  - 月相和塔罗牌居中并排
  - 5个分类按钮一行显示

- **移动端**：宽度 < 1330px
  - 单列布局
  - 5个分类按钮一行显示（缩小间距和字体）
  - 优化触摸交互

**影响范围**：
- 所有页面都需要响应式适配
- 确保移动端和PC端体验一致

---

## 💾 数据存储方案（已实现）

**决策日期**：2024-XX-XX

**决策内容**：
Demo 阶段使用浏览器 `localStorage` 进行本地存储。

**存储内容**：
- 每日占卜数据（情绪、塔罗牌、月相、生成内容）
- 任务完成状态
- 所有数据按日期键值存储

**数据结构**：
```javascript
{
  date: "2024-01-15",
  timestamp: "2024-01-15T10:30:00.000Z",
  emotion: "平静",
  card: { id, name, nameCn, file, reversed },
  moonPhase: { phase, name, nameCn, emoji, energy },
  reading: {
    guidance_one_line: "...",
    today_analysis: "...",
    healing_task: "* ...",
    category_guidances: {...},
    lucky_elements: {...}
  },
  taskCompleted: false
}
```

**后续规划**：
- 生产环境需要后端数据库存储
- 支持多设备同步
- 支持数据导出和备份

---

## 📱 已实现功能清单

**实现日期**：2024-XX-XX

### ✅ 核心功能
- [x] 每日占卜流程（情绪选择 + 抽牌）
- [x] 月相计算和显示
- [x] 塔罗牌抽取（78张，支持正逆位）
- [x] LLM 生成占卜内容（DeepSeek API）
- [x] 主界面完整展示
- [x] 疗愈任务（可完成）
- [x] 分类指引（5个领域）
- [x] 幸运元素展示
- [x] 数据本地存储（localStorage）
- [x] 重新占卜功能

### ✅ UI/UX 功能
- [x] 三页面流程（占卜 → Loading → 主界面）
- [x] 情绪选择（5档按钮式）
- [x] 动态背景色（基于情绪）
- [x] 逆位牌倒置显示
- [x] 响应式设计（PC + 移动端）
- [x] 统一配色方案（#6D5C5C 色系）

### ✅ 技术实现
- [x] 月相本地计算（Julian Day 算法）
- [x] 塔罗牌完全随机抽取
- [x] DeepSeek API 集成
- [x] localStorage 数据存储
- [x] 移动端点击和长按支持

### ⏳ 待实现功能
- [ ] 周总结和月总结
- [ ] 日历视图
- [ ] 用户系统（注册/登录）
- [ ] 多占卜师系统
- [ ] 专项占卜
- [ ] 进阶追问对话

---

## 📝 待决策事项

### 待回答的关键问题
- Q2: 目标用户更细分？
- Q3: 塔罗牌库与解读标准
- Q6-Q8: 商业化细节（定价、点数系统、IAA）
- Q9-Q11: 治愈任务系统细节
- Q12-Q14: 数据与AI细节
- Q15-Q17: 游戏化与留存机制
- Q18-Q19: 扩展功能优先级
- Q20-Q21: 国际化与本地化
- Q22-Q24: 技术实现细节
- Q25-Q27: 用户体验细节
- Q28-Q29: 成功指标与A/B测试
- Q30: MVP范围确认

---

## 📅 决策历史

- 2024-XX-XX: 确认核心差异化（塔罗+月相综合分析）
- 2024-XX-XX: 确认多占卜师系统技术方案
- 2024-XX-XX: 确认第一版不包含多占卜师对比功能
- 2024-XX-XX: 确认 Web Demo 技术方案（HTML/CSS/JS）
- 2024-XX-XX: 确认月相计算方案（本地计算）
- 2024-XX-XX: 确认塔罗牌抽取逻辑（完全随机，支持正逆位）
- 2024-XX-XX: 确认 UI/UX 设计（三页面流程、情绪选择、配色方案）
- 2024-XX-XX: 确认响应式设计断点（1330px）
- 2024-XX-XX: 确认数据存储方案（localStorage）
- 2024-XX-XX: Web Demo 核心功能实现完成

---

## 📊 实现状态总结

### 已完成
- ✅ Web Demo 核心功能全部实现
- ✅ 月相计算和塔罗抽取逻辑验证通过
- ✅ LLM 生成内容流程验证通过
- ✅ UI/UX 设计实现完成
- ✅ 响应式设计适配完成

### 下一步
- [ ] 迁移到 Flutter 应用
- [ ] 实现后端 API 和数据存储
- [ ] 实现周/月总结功能
- [ ] 实现用户系统
- [ ] 实现多占卜师系统

---

**注意**：本文档会持续更新，记录所有关键产品决策和实现状态。

