# 个人信息补充方案

## 目标
收集用户个人信息，用于提升占卜和疗愈的准确性。

## 流程设计

### 6步信息收集流程

#### 第1步：希望怎么称呼你？
- **类型**：文本输入
- **必填**：是
- **说明**：用于个性化称呼，如"小A"、"小明"等
- **输入限制**：2-10个字符

#### 第2步：你的性别
- **类型**：单选
- **必填**：是
- **选项**：
  - 男
  - 女
  - 非二元（Non-binary）
- **说明**：用于占卜和疗愈的个性化

#### 第3步：你的生日
- **类型**：日期选择器（年月日）
- **必填**：是
- **功能**：
  - 自动计算并显示星座
  - 验证日期有效性（不能是未来日期）
- **显示**：选择日期后，下方显示"你的星座：XX座"

#### 第4步：你的出生时间
- **类型**：小时选择器 + "不知道"选项
- **必填**：否
- **选项**：
  - 小时选择器：00:00 - 23:00（按小时选择，如14:00）
  - 或选择"我不知道"
- **说明**：用于更精确的占星计算

#### 第5步：你的出生地
- **类型**：纯文本输入（具体到城市）
- **必填**：否
- **功能**：
  - 输入城市名称
- **说明**：用于时区和地理位置相关的占卜

#### 第6步：你大多数日子更像哪种天气
- **类型**：图标选择（5种天气图标）
- **必填**：否
- **选项**：复用现有的5种天气图标
  - 🌞 阳光（对应：愉悦）
  - ☁️ 多云（对应：平静）
  - 🌧️ 阴天（对应：疲惫）
  - 🌦️ 小雨（对应：迷茫）
  - ⛈️ 大雨（对应：焦虑）
- **说明**：用于了解用户的整体情绪基调

## 交互设计

### 显示时机和入口
- **首次使用入口**：
  - 在"今日"界面右上角显示"补充个人信息"按钮
  - 点击后弹出模态框
  - **已填写过信息的用户**：此入口消失（不再显示）
  
- **个人模块入口**：
  - 在主导航"个人"模块界面显示个人信息
  - **已填写过信息**：显示已填信息 + "补充"按钮（可修改）
  - **未填写信息**：显示"补充个人信息"按钮

### 页面形式
- **弹窗/模态框**：居中显示，背景半透明遮罩
- **尺寸**：响应式设计，移动端和桌面端适配
- **关闭方式**：点击遮罩或关闭按钮可关闭（必填项未完成时需提示）

### 导航方式
- **必填项**（第1-3步）：
  - 必须填写才能进入下一步
  - 只显示"下一步"按钮
  
- **非必填项**（第4-6步）：
  - **显示"跳过"和"下一步"两个按钮**
  - 点击"跳过"：直接进入下一步，该字段保存为null
  - 点击"下一步"：保存当前填写的内容，进入下一步

### 进度指示
- 显示步骤指示器（如：1/6, 2/6...）
- 显示进度条（视觉化进度）
- 已完成步骤可点击返回修改

### 完成后的处理
- 保存到 localStorage
- 显示欢迎信息（如："欢迎，{称呼}！"）
- **跳转到今日主界面**（如果有今日占卜数据则显示主界面，否则显示每日占卜界面）

## 数据存储

### 数据结构
```javascript
{
  nickname: "小A",              // 称呼
  gender: "女",                 // 性别：男/女/非二元
  birthday: "1990-01-01",       // 生日：YYYY-MM-DD
  birthTime: "14:00",          // 出生时间：HH:mm 或 null
  birthPlace: "北京",          // 出生地：城市名称 或 null
  defaultWeather: "sunny",     // 默认天气：sunny/cloudy/overcast/rainy/stormy 或 null
  zodiac: "摩羯座",            // 自动计算的星座
  completedAt: "2024-01-01T10:00:00Z"  // 完成时间
}
```

### 存储位置
- **localStorage**：存储在浏览器本地
- **key**：`userProfile` 或 `userInfo`

## 已确认的设计决策

### 1. 第1步"希望怎么称呼你"是否必填？
- ✅ **必填**

### 2. UI显示形式
- ✅ **弹窗/模态框**（居中，背景半透明）
- 入口位置：
  - "今日"界面右上角"补充个人信息"按钮（未填写时显示）
  - "个人"模块界面（已填写显示信息+补充按钮，未填写显示补充按钮）

### 3. 非必填项的跳步方式
- ✅ **显示"跳过"和"下一步"两个按钮**

### 4. 生日选择器形式
- ✅ **日期选择器**（原生或第三方组件）

### 5. 出生地输入方式
- ✅ **纯文本输入**

### 6. 出生时间选择器
- ✅ **小时选择器**（00:00-23:00，按小时选择）

### 7. 完成后的跳转逻辑
- ✅ **跳转到今日主界面**

### 8. 数据验证规则
- **称呼**：
  - 必填
  - 字符长度：2-10个字符
  - 不能包含特殊字符（允许中文、英文、数字）
  
- **生日**：
  - 必填
  - 不能是未来日期
  - 不能超过合理范围（如1900年之前，或超过当前日期）
  - 自动计算星座
  
- **出生时间**：
  - 非必填
  - 格式：HH:00（如 14:00）
  - 或选择"我不知道"（保存为null）
  
- **出生地**：
  - 非必填
  - 纯文本输入，无验证

### 9. 修改个人信息
- ✅ 在"个人"模块界面提供"补充"按钮
- 修改时保留已填写的信息（预填充表单）
- 修改后重新保存到localStorage

### 10. 隐私和安全
- 数据存储在浏览器本地（localStorage）
- 暂不加密存储（后续可考虑）
- 建议添加隐私政策说明（可选）

## 技术实现建议

### UI入口实现
- **"今日"界面右上角按钮**：
  - 检查localStorage中是否有`userProfile`数据
  - 如果没有，显示"补充个人信息"按钮
  - 如果已有，隐藏按钮
  
- **"个人"模块界面**：
  - 检查localStorage中是否有`userProfile`数据
  - 如果有，显示已填信息卡片 + "补充"按钮
  - 如果没有，显示"补充个人信息"按钮

### 模态框实现
- 使用CSS实现半透明遮罩层
- 模态框居中显示
- 支持点击遮罩关闭（必填项未完成时提示）
- 响应式设计，移动端全屏或接近全屏

### 星座计算
- 新增星座计算函数
- 根据生日（月日）自动计算星座
- 星座列表：白羊座、金牛座、双子座、巨蟹座、狮子座、处女座、天秤座、天蝎座、射手座、摩羯座、水瓶座、双鱼座

### 天气图标复用
- 复用现有的 `EMOTION_WEATHER_MAP` 映射
- 保持图标和情绪的一致性
- 5种选项：
  - 🌞 阳光（对应：愉悦）
  - ☁️ 多云（对应：平静）
  - 🌧️ 阴天（对应：疲惫）
  - 🌦️ 小雨（对应：迷茫）
  - ⛈️ 大雨（对应：焦虑）

### 表单验证
- **实时验证**：
  - 称呼：输入时检查长度和字符类型
  - 生日：选择日期时检查有效性
  
- **提交验证**：
  - 必填项未填写时，显示错误提示
  - 阻止进入下一步

### 数据存储
- **localStorage key**：`userProfile`
- **存储时机**：每个步骤完成后实时保存（防止意外关闭丢失数据）
- **数据格式**：JSON字符串

### 响应式设计
- 移动端和桌面端适配
- 保持与现有UI风格一致（使用相同的颜色、字体、间距等）
- 模态框在移动端可以全屏显示或占满屏幕的80-90%

### 用户体验优化
- 步骤切换时添加平滑过渡动画
- 保存进度：即使中途关闭，重新打开时从上次的步骤继续
- 完成提示：所有步骤完成后显示欢迎信息

## 后续使用场景

### 占卜内容个性化
- 在生成占卜内容时，使用用户信息（如称呼、性别、星座）
- 提供更个性化的解读和建议
- 例如：在提示语中使用"小A"、"根据你的星座特点"等

### 疗愈内容定制
- 根据用户的默认天气（情绪基调）调整内容
- 结合星座特点提供针对性建议
- 根据性别和生日提供更精准的指引

### 数据分析
- 统计用户特征分布
- 优化占卜算法和内容生成
- 了解用户群体的特征和偏好

## 实现步骤

### Phase 1: 数据结构与存储
1. 定义用户信息数据结构
2. 实现localStorage存储/读取函数
3. 实现星座计算函数

### Phase 2: UI入口
1. 在"今日"界面右上角添加"补充个人信息"按钮
2. 实现按钮显示/隐藏逻辑（根据是否已填写信息）
3. 在"个人"模块添加信息显示和补充入口

### Phase 3: 模态框与表单
1. 创建个人信息补充模态框
2. 实现6步表单界面
3. 实现步骤切换逻辑
4. 实现进度指示器

### Phase 4: 表单功能
1. 实现文本输入（称呼、出生地）
2. 实现日期选择器（生日）
3. 实现小时选择器（出生时间）
4. 实现单选按钮（性别）
5. 实现图标选择（默认天气）
6. 实现表单验证

### Phase 5: 交互优化
1. 实现步骤切换动画
2. 实现保存进度功能
3. 实现完成后的欢迎提示
4. 实现跳转逻辑

### Phase 6: 个人模块信息显示
1. 在"个人"模块显示已填信息卡片
2. 实现信息格式化显示（如星座图标、天气图标等）
3. 实现"补充"按钮功能

## 待实现文件清单

### JavaScript文件
- `demo/js/user-profile.js` - 用户信息管理（存储、读取、验证）
- `demo/js/zodiac.js` - 星座计算函数
- 在 `demo/js/ui.js` 中添加模态框UI逻辑
- 在 `demo/js/main.js` 中添加入口按钮逻辑

### HTML文件
- 在 `demo/index.html` 中添加模态框HTML结构
- 在"个人"模块添加信息显示区域

### CSS文件
- 在 `demo/css/style.css` 中添加模态框样式
- 添加表单样式
- 添加个人信息卡片样式

