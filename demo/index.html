<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tarot Mirror - 每日塔罗</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/tarot-module.css">
    <link rel="stylesheet" href="css/profile.css">
    <link rel="stylesheet" href="css/miri-chat.css">
</head>
<body>
    <!-- 页面1: 每日占卜页面（情绪选择 + 抽牌） -->
    <div id="daily-reading-page" class="page active">
        <div class="daily-reading-content">
            <h1 class="page-title">开始今日占卜</h1>
            
            <!-- 选择情绪状态 -->
            <div class="emotion-section">
                <h2 class="section-subtitle">选择你今日的内在状态</h2>
                <div class="emotion-slider-container">
                    <div class="emotion-slider" id="emotion-slider">
                        <div class="emotion-track">
                            <div class="emotion-markers">
                                <div class="emotion-marker" data-value="0">
                                    <img src="weather/1.png" alt="阳光" class="weather-icon" data-weather="1">
                                    <span class="label">愉悦</span>
                                </div>
                                <div class="emotion-marker" data-value="1">
                                    <img src="weather/2.png" alt="多云" class="weather-icon" data-weather="2">
                                    <span class="label">平静</span>
                                </div>
                                <div class="emotion-marker" data-value="2">
                                    <img src="weather/3.png" alt="阴天" class="weather-icon" data-weather="3">
                                    <span class="label">疲惫</span>
                                </div>
                                <div class="emotion-marker" data-value="3">
                                    <img src="weather/4.png" alt="小雨" class="weather-icon" data-weather="4">
                                    <span class="label">迷茫</span>
                                </div>
                                <div class="emotion-marker" data-value="4">
                                    <img src="weather/5.png" alt="大雨" class="weather-icon" data-weather="5">
                                    <span class="label">焦虑</span>
                                </div>
                            </div>
                            <input type="range" id="emotion-input" min="0" max="4" value="1" step="1" class="slider-input">
                            <div class="slider-thumb" id="slider-thumb">
                                <img src="weather/2.png" alt="当前状态" class="current-weather-icon">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 抽牌区域 -->
            <div class="card-section">
                <h2 class="section-subtitle">抽取你的今日塔罗</h2>
                <div class="card-draw-container">
                    <div class="card-pile" id="card-pile">
                        <img src="Cards-png/CardBacks.png" alt="塔罗牌堆" class="card-back">
                        <div class="draw-hint">
                            <p>点击牌堆抽牌</p>
                        </div>
                    </div>
                    <div class="drawn-card-container" id="drawn-card-container" style="display: none;">
                        <div class="card-flip">
                            <img id="drawn-card-img" src="" alt="今日塔罗" class="drawn-card">
                        </div>
                        <div class="card-name" id="card-name"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 页面2: Loading 界面 -->
    <div id="loading-page" class="page" style="display: none;">
        <div class="loading-container">
            <!-- 显示抽到的塔罗牌 -->
            <div class="loading-card-container" id="loading-card-container">
                <div class="loading-card-flip">
                    <img id="loading-card-img" src="" alt="今日塔罗" class="loading-card">
                </div>
                <div class="loading-card-name" id="loading-card-name"></div>
            </div>
            
            <!-- 生成中动画和文字 -->
            <div class="loading-status">
                <div class="loading-animation">
                    <div class="loading-dot"></div>
                    <div class="loading-dot"></div>
                    <div class="loading-dot"></div>
                </div>
                <p class="loading-text">正在生成你的今日指引...</p>
                <p class="loading-subtext">结合塔罗与月相，为你定制专属指引</p>
            </div>
        </div>
    </div>

    <!-- 页面3: 日历界面（回顾/签到） -->
    <div id="calendar-page" class="page" style="display: none;">
        <div class="calendar-container">
            <!-- 日历模式切换按钮（移动端显示在顶部） -->
            <div class="calendar-mode-switcher">
                <button class="calendar-mode-btn active" id="moon-calendar-btn" data-mode="moon">
                    <span class="btn-icon">🌙</span>
                    <span class="btn-text">月相日历</span>
                </button>
                <button class="calendar-mode-btn" id="mood-calendar-btn" data-mode="mood">
                    <span class="btn-icon">😊</span>
                    <span class="btn-text">状态日历</span>
                </button>
            </div>
            
            <div class="calendar-header">
                <button class="calendar-nav-btn" id="cal-prev-btn" aria-label="Previous month">‹</button>
                <div class="calendar-header-center">
                    <div class="calendar-month-title" id="cal-month-title">January 2026</div>
                    <div class="calendar-streak" id="cal-streak">Streak: 0</div>
                </div>
                <button class="calendar-nav-btn" id="cal-next-btn" aria-label="Next month">›</button>
            </div>

            <div class="calendar-weekdays">
                <div class="weekday">Sun</div>
                <div class="weekday">Mon</div>
                <div class="weekday">Tue</div>
                <div class="weekday">Wed</div>
                <div class="weekday">Thu</div>
                <div class="weekday">Fri</div>
                <div class="weekday">Sat</div>
            </div>

            <div class="calendar-grid" id="calendar-grid"></div>
        </div>
    </div>

    <!-- 页面3: 塔罗专项占卜 -->
    <div id="tarot-page" class="page" style="display: none;">
        <div class="tarot-module-container">
            <!-- 每日限制提示 -->
            <div id="tarot-daily-limit-notice" class="tarot-limit-notice" style="display: none;"></div>
            
            <!-- 问题输入区 -->
            <div class="tarot-question-section">
                <label class="section-label">你的问题</label>
                <textarea 
                    id="tarot-question-input" 
                    class="tarot-question-input" 
                    placeholder="请输入你想要占卜的问题...（例如：我该不该换工作？我们的关系会如何发展？）"
                    rows="3"
                    maxlength="200"
                ></textarea>
            </div>
            
            <!-- 牌阵切换区 -->
            <div class="tarot-spread-selector">
                <label class="section-label">选择牌阵</label>
                <div class="spread-buttons">
                    <button class="spread-type-btn active" data-spread="3张">3张</button>
                    <button class="spread-type-btn" data-spread="4张">4张</button>
                    <button class="spread-type-btn" data-spread="6张">6张</button>
                </div>
            </div>
            
            <!-- 牌阵展示区 -->
            <div id="tarot-spread-container" class="tarot-spread-container spread-grid-3"></div>
            
            <!-- 抽牌区 -->
            <div class="tarot-draw-area">
                <div id="tarot-card-pile" class="tarot-card-pile" style="display: block;">
                    <img src="Cards-png/CardBacks.png" alt="牌堆" class="pile-image">
                    <div class="pile-hint">点击抽牌</div>
                </div>
                <button id="tarot-reading-btn" class="tarot-reading-btn" style="display: none;">
                    🔮 开始占卜
                </button>
            </div>
            
            <!-- 占卜结果显示区 -->
            <div id="tarot-result-area" class="tarot-result-area" style="display: none;"></div>
            
            <!-- 补充聊天区 -->
            <div id="tarot-chat-area" class="tarot-chat-area" style="display: none;">
                <div class="chat-header">
                    <div class="chat-title">与 Luna 对话</div>
                    <div id="tarot-chat-rounds-display" class="chat-rounds-display"></div>
                </div>
                <div id="tarot-chat-limit-notice" class="chat-limit-notice" style="display: none;"></div>
                <div id="tarot-chat-messages" class="chat-messages"></div>
                <div class="chat-input-area">
                    <textarea 
                        id="tarot-chat-input" 
                        class="chat-input" 
                        placeholder="想深入了解哪个方面？或有其他疑问？"
                        rows="2"
                    ></textarea>
                    <button id="tarot-chat-send" class="chat-send-btn">发送</button>
                </div>
            </div>
            
            <!-- 历史占卜结果 -->
            <div id="tarot-history-container" class="tarot-history-container"></div>
        </div>
    </div>

    <!-- 页面5: 个人模块 -->
    <div id="profile-page" class="page" style="display: none;">
        <div class="profile-content">
            <h1 class="page-title">个人信息</h1>
            
            <!-- 个人信息显示区域 -->
            <div id="profile-info-container" class="profile-info-container" style="display: none;">
                <!-- 动态生成 -->
            </div>
            
            <!-- 未填写信息提示 -->
            <div id="profile-empty-container" class="profile-empty-container" style="display: none;">
                <div class="profile-empty-icon">👤</div>
                <p class="profile-empty-text">还没有填写个人信息</p>
                <button id="profile-add-btn-empty" class="profile-add-btn">补充个人信息</button>
            </div>
        </div>
    </div>

    <!-- 页面4: 主界面（结果展示） -->
    <div id="main-page" class="page" style="display: none;">
        <!-- 顶部头部区域 -->
        <div class="main-page-header">
            <div class="main-page-date" id="main-page-date">January 11</div>
            <div class="main-page-right">
                <button id="add-profile-btn" class="add-profile-btn" style="display: none;">
                    补充个人信息
                </button>
                <div id="main-page-greeting" class="main-page-greeting" style="display: none;">
                    Hi，<span id="main-page-nickname"></span>
                </div>
            </div>
        </div>
        
        <!-- 今日占卜按钮（如果未完成） -->
        <button id="start-daily-btn" class="start-daily-btn" style="display: none;">
            <span class="btn-icon">🔮</span>
            <span>开始今日占卜</span>
        </button>

        <div class="main-content">
            <!-- 周历显示 -->
            <div class="weekly-calendar-container" id="weekly-calendar-container">
                <div class="weekly-calendar-grid" id="weekly-calendar-grid">
                    <!-- 动态生成 -->
                </div>
            </div>
            
            <!-- 0. 精炼指引（在今日指引模块上方） -->
            <section class="concise-guidance-section">
                <p class="concise-guidance" id="concise-guidance"></p>
            </section>

            <!-- 1. 今日指引和塔罗牌（左右分列） -->
            <section class="moon-phase-section">
                <!-- 左侧：今日指引 -->
                <div class="guidance-left">
                    <h3 class="section-title">今日指引</h3>
                    <p class="guidance-one-line" id="guidance-one-line"></p>
                </div>
                <!-- 右侧：塔罗牌+月相图标 -->
                <div class="today-card" id="today-card-container" style="display: none;">
                    <div class="card-image-wrapper">
                        <img id="today-card-img" src="" alt="今日塔罗" class="today-card-img">
                        <div class="moon-emoji-overlay" id="moon-emoji">🌕</div>
                    </div>
                    <div class="today-card-name" id="today-card-name"></div>
                </div>
            </section>

            <!-- 3.5. 今日分析 -->
            <section class="today-analysis-section">
                <h3 class="section-title">今日分析</h3>
                <div class="today-analysis-content" id="today-analysis-content"></div>
            </section>

            <!-- 4. 疗愈任务 -->
            <section class="healing-task-section">
                <h3 class="section-title">疗愈 Boost</h3>
                <div class="healing-task-card" id="healing-task-card">
                    <p class="task-text" id="healing-task-text"></p>
                    <button id="complete-task-btn" class="btn-complete" style="display: none;">
                        <span>✓ 完成</span>
                    </button>
                    <div class="task-completed" id="task-completed" style="display: none;">
                        <span class="checkmark">✓</span>
                        <span>已完成</span>
                    </div>
                </div>
            </section>

            <!-- 3.6. 情绪记录 -->
            <section class="emotion-record-section">
                <button id="emotion-record-btn" class="emotion-record-btn">
                    <span>情绪记录</span>
                </button>
            </section>

            <!-- 5. 查看各领域指引 -->
            <section class="category-section">
                <h3 class="section-title">查看各领域指引</h3>
                <div class="category-buttons">
                    <button class="category-btn" data-category="爱情">爱情</button>
                    <button class="category-btn" data-category="财富">财富</button>
                    <button class="category-btn" data-category="工作">工作</button>
                    <button class="category-btn" data-category="学习">学习</button>
                    <button class="category-btn" data-category="家庭">家庭</button>
                    <button class="category-btn" data-category="人际">人际</button>
                </div>
            </section>
            
            <!-- 领域指引模态框 -->
            <div id="category-modal" class="category-modal" style="display: none;">
                <div class="category-modal-overlay"></div>
                <div class="category-modal-content">
                    <div class="category-modal-header">
                        <h3 id="category-modal-title">领域指引</h3>
                        <button class="category-modal-close" id="category-modal-close">×</button>
                    </div>
                    <div class="category-modal-body">
                        <div id="category-modal-loading" class="category-modal-loading" style="display: none;">
                            <div class="loading-spinner"></div>
                            <p>正在生成指引...</p>
                        </div>
                        <div id="category-modal-content" class="category-modal-text"></div>
                    </div>
                </div>
            </div>

            <!-- 6. 星座星盘分析 -->
            <section class="zodiac-horoscope-section">
                <div class="zodiac-horoscope-buttons">
                    <button id="zodiac-analysis-btn" class="zodiac-horoscope-btn">
                        <span class="zodiac-horoscope-icon" id="zodiac-icon">✨</span>
                        <span class="zodiac-horoscope-text">每日星座</span>
                    </button>
                    <button id="horoscope-analysis-btn" class="zodiac-horoscope-btn">
                        <span class="zodiac-horoscope-icon">🔮</span>
                        <span class="zodiac-horoscope-text">星盘分析</span>
                    </button>
                </div>
                <!-- 分析结果展示区域 -->
                <div class="zodiac-horoscope-content" id="zodiac-horoscope-content" style="display: none;">
                    <div class="zodiac-horoscope-result" id="zodiac-horoscope-result"></div>
                </div>
            </section>

            <!-- 7. 今日幸运元素 -->
            <section class="lucky-elements-section">
                <h3 class="section-title">今日幸运元素</h3>
                <div class="lucky-elements">
                    <div class="lucky-item">
                        <span class="lucky-icon">🎨</span>
                        <div>
                            <div class="lucky-label">幸运色</div>
                            <div class="lucky-value" id="lucky-color"></div>
                        </div>
                    </div>
                    <div class="lucky-item">
                        <span class="lucky-icon">💎</span>
                        <div>
                            <div class="lucky-label">今日饰品</div>
                            <div class="lucky-value" id="lucky-accessory"></div>
                        </div>
                    </div>
                    <div class="lucky-item">
                        <span class="lucky-icon">🔢</span>
                        <div>
                            <div class="lucky-label">幸运数字</div>
                            <div class="lucky-value" id="lucky-number"></div>
                        </div>
                    </div>
                    <div class="lucky-item">
                        <span class="lucky-icon">🏺</span>
                        <div>
                            <div class="lucky-label">今日摆件</div>
                            <div class="lucky-value" id="lucky-decoration"></div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
        
        <!-- 重新占卜按钮（固定在底部） -->
        <button id="reset-btn" class="reset-btn">
            <span class="btn-icon">🔄</span>
            <span>重新占卜</span>
        </button>
    </div>

    <!-- 日历日期详情弹层 -->
    <div class="calendar-modal" id="calendar-day-modal" style="display: none;">
        <div class="calendar-modal-backdrop" id="calendar-modal-backdrop"></div>
        <div class="calendar-modal-sheet" role="dialog" aria-modal="true">
            <div class="calendar-modal-handle"></div>
            <div class="calendar-modal-header">
                <div class="calendar-modal-title" id="calendar-modal-title">January 7, 2026</div>
                <button class="calendar-modal-close" id="calendar-modal-close" aria-label="Close">✕</button>
            </div>
            <div class="calendar-modal-content" id="calendar-modal-content"></div>
        </div>
    </div>

    <!-- Miri 聊天页面 -->
    <div id="miri-page" class="page" style="display: none;">
        <div class="miri-container">
            <!-- 主题图区域 -->
            <div class="miri-header-image">
                <img src="20260113-222035.jpg" alt="Miri" class="miri-theme-image">
            </div>
            
            <!-- 聊天显示区 -->
            <div class="miri-chat-area" id="miri-chat-area">
                <!-- 消息将通过 JS 动态添加 -->
            </div>
            
            <!-- 话语提示区 -->
            <div class="miri-suggestions" id="miri-suggestions">
                <button class="suggestion-btn" data-index="0">加载中...</button>
                <button class="suggestion-btn" data-index="1">加载中...</button>
                <button class="suggestion-btn" data-index="2">加载中...</button>
            </div>
            
            <!-- 用户输入区 -->
            <div class="miri-input-area">
                <input 
                    type="text"
                    id="miri-input" 
                    class="miri-input-text" 
                    placeholder="和 Miri 说点什么..."
                    maxlength="200"
                />
                <button id="miri-send-btn" class="miri-send-btn" disabled>发送</button>
            </div>
        </div>
    </div>

    <!-- 情绪记录弹板 -->
    <div class="emotion-record-modal" id="emotion-record-modal" style="display: none;">
        <div class="emotion-record-modal-backdrop" id="emotion-record-modal-backdrop"></div>
        <div class="emotion-record-modal-sheet">
            <div class="emotion-record-modal-header">
                <h3 class="emotion-record-modal-title">情绪记录</h3>
                <button class="emotion-record-modal-close" id="emotion-record-modal-close">✕</button>
            </div>
            <div class="emotion-record-modal-content">
                <div class="current-emotion-section">
                    <div class="current-emotion-label">此刻状态</div>
                    <div class="current-emotion-options">
                        <button class="current-emotion-btn" data-emotion="愉悦">
                            <img src="weather/1.png" alt="愉悦" class="current-emotion-icon">
                            <span>愉悦</span>
                        </button>
                        <button class="current-emotion-btn" data-emotion="平静">
                            <img src="weather/2.png" alt="平静" class="current-emotion-icon">
                            <span>平静</span>
                        </button>
                        <button class="current-emotion-btn" data-emotion="疲惫">
                            <img src="weather/3.png" alt="疲惫" class="current-emotion-icon">
                            <span>疲惫</span>
                        </button>
                        <button class="current-emotion-btn" data-emotion="迷茫">
                            <img src="weather/4.png" alt="迷茫" class="current-emotion-icon">
                            <span>迷茫</span>
                        </button>
                        <button class="current-emotion-btn" data-emotion="焦虑">
                            <img src="weather/5.png" alt="焦虑" class="current-emotion-icon">
                            <span>焦虑</span>
                        </button>
                        <button class="current-emotion-btn" data-emotion="雨过天晴">
                            <img src="weather/6.png" alt="雨过天晴" class="current-emotion-icon">
                            <span>雨过天晴</span>
                        </button>
                    </div>
                </div>
                <div class="emotion-record-input-section">
                    <textarea 
                        id="emotion-record-modal-input" 
                        class="emotion-record-modal-textarea" 
                        placeholder="记录今日的心境、事件或想法...（选填）"
                        rows="4"
                    ></textarea>
                </div>
                <div class="emotion-record-modal-actions">
                    <button id="save-emotion-record-modal-btn" class="emotion-record-modal-save-btn">
                        <span>💾 保存</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 情绪选择弹板（完成任务后） -->
    <div class="emotion-select-toast" id="emotion-select-toast" style="display: none;">
        <div class="emotion-select-toast-card">
            <div class="emotion-select-toast-title">情绪能量？</div>
            <div class="emotion-select-options">
                <button class="emotion-select-btn" data-value="-1" id="emotion-select-minus">
                    <span class="emotion-select-icon">-1</span>
                </button>
                <button class="emotion-select-btn" data-value="0" id="emotion-select-zero">
                    <span class="emotion-select-icon">0</span>
                </button>
                <button class="emotion-select-btn" data-value="1" id="emotion-select-plus">
                    <span class="emotion-select-icon">+1</span>
                </button>
            </div>
        </div>
    </div>

    <!-- 今日签到完成弹板 -->
    <div class="checkin-toast" id="checkin-toast" style="display: none;">
        <div class="checkin-toast-card">
            <div class="checkin-toast-icon">🎉</div>
            <div class="checkin-toast-title">今日签到完成</div>
            <div class="checkin-toast-subtitle">你完成了今日占卜与疗愈任务</div>
            <div class="checkin-toast-streak" id="checkin-toast-streak"></div>
            <button class="checkin-toast-btn" id="checkin-toast-btn">太棒了！</button>
        </div>
    </div>

    <!-- 个人信息补充模态框 -->
    <div class="profile-modal" id="profile-modal" style="display: none;">
        <div class="profile-modal-backdrop" id="profile-modal-backdrop"></div>
        <div class="profile-modal-content">
            <div class="profile-modal-header">
                <h2 class="profile-modal-title">补充个人信息</h2>
                <button class="profile-modal-close" id="profile-modal-close">✕</button>
            </div>
            
            <!-- 进度指示器 -->
            <div class="profile-progress">
                <div class="profile-progress-bar">
                    <div class="profile-progress-fill" id="profile-progress-fill"></div>
                </div>
                <div class="profile-progress-text" id="profile-progress-text">1/6</div>
            </div>
            
            <!-- 表单内容区域 -->
            <div class="profile-form-container" id="profile-form-container">
                <!-- 动态生成6步表单 -->
            </div>
            
            <!-- 导航按钮 -->
            <div class="profile-form-actions" id="profile-form-actions">
                <!-- 动态生成按钮 -->
            </div>
        </div>
    </div>

    <!-- 底部导航栏 -->
    <nav class="bottom-nav">
        <div class="nav-item" data-nav="calendar">
            <span class="nav-icon">📅</span>
            <span class="nav-label">日历</span>
        </div>
        <div class="nav-item" data-nav="tarot">
            <span class="nav-icon">🔮</span>
            <span class="nav-label">塔罗</span>
        </div>
        <div class="nav-item active" data-nav="today">
            <span class="nav-icon">✨</span>
            <span class="nav-label">今日</span>
        </div>
        <div class="nav-item" data-nav="miri">
            <span class="nav-icon">☁️</span>
            <span class="nav-label">Miri</span>
        </div>
        <div class="nav-item" data-nav="profile">
            <span class="nav-icon">👤</span>
            <span class="nav-label">个人</span>
        </div>
    </nav>

    <script src="js/card-intensity.js"></script>
    <script src="js/tarot-cards.js"></script>
    <script src="js/moon-phase.js"></script>
    <script src="js/zodiac.js"></script>
    <script src="js/user-profile.js"></script>
    <script src="js/profile-modal.js"></script>
    <script src="js/storage.js"></script>
    <script src="js/api.js"></script>
    <script src="js/zodiac-horoscope.js"></script>
    <script src="js/tarot-storage.js"></script>
    <script src="js/tarot-spread.js"></script>
    <script src="js/tarot-chat.js"></script>
    <script src="js/tarot-module.js"></script>
    <script src="js/miri-chat.js?v=20260113"></script>
    <script src="js/ui.js"></script>
    <script src="js/main.js?v=20260113"></script>
</body>
</html>

