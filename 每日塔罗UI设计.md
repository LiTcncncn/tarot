# 每日塔罗 + 主界面设计文档

## 📱 整体流程

```
App启动 → 每日占卜全屏页面 → 主界面
```

---

## ✅ 已确认的设计决策

### 每日占卜触发时机
- **每天凌晨用户第一次进入 app**，自动触发全屏占卜页面
- **右上角有跳过按钮**，点击后直接进入主界面
- **主界面突出显示"今日占卜"按钮**，引导用户完成每日占卜

### LLM 调用时机
- **抽牌后立即调用** LLM API 生成内容
- 显示加载状态，等待生成完成

### 5个分类的生成方式
- **一次性生成所有5个分类**的内容
- 用户点击分类按钮时直接加载已生成的内容（无需再次调用API）

### 分类按钮交互方式
- **展开/折叠方式**，在同一页面内显示
- 点击分类按钮展开/折叠对应内容

### LLM Prompt 设计
- **尝试一次性生成所有内容**（综合指引、具体占卜、分类占卜、幸运元素、疗愈任务）
- 详见 [`LLM_PROMPT_TEMPLATE.md`](./LLM_PROMPT_TEMPLATE.md)

### 滑动条样式
- **分段滑动条**，5个固定档位
- 滑动时有平滑动画

### 抽牌交互方式
- **Demo 阶段同时支持长按和点击**
- 长按更有仪式感，点击更快捷

### 情绪状态的重要性
- **情绪状态是重要参数**，必须影响生成内容
- 内容要击中用户情绪，给予安慰或建议
- 针对不同情绪状态（特别是疲惫和焦虑），提供特别温柔和关怀的内容

### 疗愈任务
- **根据用户情绪状态生成**，提供疗愈或缓解方法
- 任务库可后续设计，demo 阶段由 LLM 生成

---

## 🎯 页面一：每日占卜全屏页面

### 页面描述
用户每日首次打开 App 时，进入每日占卜流程，完成占卜后进入主界面。
- 右上角有**跳过按钮**，可直接进入主界面
- 主界面会显示"今日占卜"按钮，引导用户完成占卜

### 交互流程

#### Step 1: 选择今日内在状态

**界面元素**：
- **标题**："选择你今日的内在状态"
- **滑动条组件**：5档情绪选择
  - 档位1：😊 愉悦
  - 档位2：😌 平静（默认选中）
  - 档位3：😴 疲惫
  - 档位4：🤔 迷茫
  - 档位5：😰 焦虑

**交互方式**：
- **分段滑动条**（5个固定档位）
- 可以在5个档位间滑动选择
- 默认定位在档位2（平静）
- 选中档位有视觉反馈（高亮、动画）
- 滑动时有平滑动画

**视觉设计**：
- 滑动条样式：圆润、柔和
- 每个档位显示对应的 emoji 和文字
- 选中状态有明显的视觉区分

**下一步按钮**：
- 在滑动条下方显示"下一步"按钮
- 可以随时切换情绪档位
- 点击"下一步"进入抽牌环节

---

#### Step 2: 抽一张塔罗牌

**界面元素**：
- **标题**："抽取你的今日塔罗"
- **牌堆动画**：显示一叠塔罗牌背面
- **抽牌提示**："长按牌堆抽牌" 或 "点击抽牌"

**交互方式**：
- **支持两种方式**（Demo 阶段）：
  - **长按牌堆抽牌**（有仪式感）
  - **点击牌堆抽牌**（快捷方式）
- 抽牌动画：牌从牌堆中飞出/翻转
- 翻牌动画：卡片翻转，显示牌面正面
- **抽牌完成后立即调用 LLM**，显示加载状态

**视觉设计**：
- 牌堆：多张牌叠加的视觉效果
- 牌面：精美设计的塔罗牌（78张标准塔罗）
- 动画：流畅的翻牌动画，有仪式感

**完成**：
- 抽牌完成后，显示牌面名称
- 自动进入主界面（或显示"进入今日指引"按钮）

---

## 🏠 页面二：主界面

### 页面描述
主界面展示今日占卜结果、月相信息、疗愈建议等所有内容。

### 布局结构（从上到下）

---

#### 1. 今日月相显示

**位置**：顶部区域

**显示内容**：
- 月相 emoji（🌑/🌒/🌓/🌔/🌕/🌖/🌗/🌘）
- 月相名称（New Moon / Full Moon 等）
- 月相能量描述（可选，简短）

**视觉设计**：
- 月相图标较大，醒目
- 简洁优雅的卡片样式
- 可以点击查看详细月相信息

---

#### 2. 今日塔罗牌显示

**位置**：月相下方

**显示内容**：
- 今日抽到的塔罗牌牌面图片/卡片
- 牌面名称（如 "The Fool" / "愚者"）
- 牌面编号（可选）

**视觉设计**：
- 塔罗牌卡片样式，精美设计
- 可以点击查看牌面详细含义
- 支持翻转动画（正面/背面）

---

#### 3. 今日综合指引（LLM 生成）

**位置**：塔罗牌下方

**显示内容**：
- **标题**："今日指引" 或 "Your Guidance Today"
- **一句话综合占卜**（40汉字以内）
  - 示例："今日专注于发挥创造力与领导力，通过合作和聆听提升能量，轻轻放下过度自信的倾向。"
  - 不涉及具体领域（情感、事业等），只是综合指引

**视觉设计**：
- 文字样式：优雅、易读
- 可以添加背景色或卡片样式
- 支持分享功能

**数据来源**：
- LLM（DeepSeek）根据塔罗牌 + 月相生成
- 结合用户选择的情绪状态（可选）

---

#### 4. 疗愈任务（重要功能）

**位置**：紧跟在"今日综合指引"下方

**显示内容**：
- **标题**："今日疗愈任务" 或 "Today's Healing Task"
- **任务描述**：根据月相+塔罗+用户内在状态生成
  - 示例："* 注视远方一座塔楼 20 秒"
  - 简洁明了，可执行

**交互方式**：
- 显示任务卡片
- 用户可以自觉完成任务
- **完成按钮**："完成" 或 "✓ 完成"
- 点击完成按钮后：
  - 按钮变为已完成状态
  - 显示完成动画/反馈
  - 可以记录完成时间
  - （可选）解锁"再来一个"任务

**视觉设计**：
- 任务卡片样式
- 完成按钮醒目但不过于抢眼
- 已完成状态有明显的视觉反馈

**数据来源**：
- **LLM 根据用户情绪状态生成**，提供疗愈或缓解方法
- 主要考虑因素：
  - 用户选择的情绪状态（最重要）
  - 今日月相
  - 今日塔罗牌
- Demo 阶段由 LLM 直接生成，后续可设计任务库

---

#### 5. 具体占卜结果（2项）

**位置**：疗愈任务下方

**显示内容**：
- **标题**："今日指引详情" 或 "Detailed Guidance"
- **显示2项具体占卜结果**：
  - 可以是：情感、工作、学习、生活、家庭中的任意2项
  - 每项显示标题（如"情感"）+ 指引内容（80汉字以内）
  - 示例：
    ```
    情感：今日在关系中保持开放和倾听，避免过度敏感...
    
    工作：在团队合作中发挥领导力，但要注意平衡...
    ```

**视觉设计**：
- 卡片列表样式
- 每项占卜结果一个卡片
- 清晰的分组和标题

**数据来源**：
- LLM 根据塔罗+月相+情绪状态生成
- 自动选择最相关的2个领域进行解读
- 内容要击中用户情绪，给予安慰或建议

---

#### 6. 分类按钮区域

**位置**：具体占卜结果下方

**显示内容**：
- **标题**："查看各领域指引"（可选）
- **5个分类按钮**：
  - 情感
  - 工作
  - 学习
  - 生活
  - 家庭

**交互方式**：
- 用户点击某个分类按钮
- **展开/折叠显示**该领域的详细占卜结果和指引（60汉字以内）
- **在同一页面内显示**，不跳转页面
- 展开/折叠有平滑动画
- **内容已预生成**，点击后直接加载（无需再次调用API）

**视觉设计**：
- 按钮样式：圆角、柔和
- 5个按钮横向排列或网格排列
- 点击后有视觉反馈

**数据来源**：
- **LLM 一次性生成所有5个分类**的内容
- 点击分类按钮时直接加载已生成的内容
- 每个分类的占卜结果（60汉字以内）

---

#### 7. 今日幸运元素

**位置**：分类按钮下方或底部

**显示内容**：
- **标题**："今日幸运元素" 或 "Today's Lucky Elements"
- **4个元素**：
  - 🎨 今日幸运色
  - 💎 今日饰品
  - 🔢 今日幸运数字
  - 🏺 今日摆件

**显示方式**：
- 可以是4个卡片横向排列
- 或2x2网格布局
- 每个元素显示图标+名称+具体内容

**视觉设计**：
- 幸运色显示实际颜色块
- 其他元素显示图标和文字
- 整体卡片样式，美观简洁

**数据来源**：
- LLM 根据塔罗+月相生成
- 可以是固定的对应关系（如某种塔罗牌对应某种颜色）

---

## 🔄 页面交互逻辑

### 进入逻辑

1. **每天凌晨用户第一次进入 app**：
   - 检测今日是否已完成每日占卜
   - 如果未完成 → 自动进入每日占卜全屏页面
   - 如果已完成 → 直接进入主界面

2. **占卜页面**：
   - 右上角有**跳过按钮**
   - 点击跳过 → 直接进入主界面
   - 主界面会突出显示"今日占卜"按钮，引导用户完成

3. **非首次打开**：
   - 直接进入主界面
   - 可以在主界面点击"今日占卜"按钮重新占卜

### 数据加载逻辑

1. **每日占卜页面**：
   - 用户选择情绪状态（本地保存）
   - 抽牌（随机或基于算法）
   - 保存今日塔罗牌记录

2. **主界面**：
   - 加载今日月相（本地计算）
   - 显示今日抽到的塔罗牌
   - **抽牌完成后立即调用 LLM API**，一次性生成所有内容：
     - 综合指引（40字）
     - 2项具体占卜（80字）
     - 5个分类的占卜（各60字，一次性生成）
     - 幸运元素（4项）
     - 疗愈任务（1个）
   - 显示加载状态，等待生成完成

---

## 📊 数据流设计

### 输入数据
1. 用户选择的情绪状态（5档之一）
2. 今日抽到的塔罗牌（78张之一）
3. 今日月相（自动计算）

### LLM 输入 Prompt

```
系统角色：你是温柔的塔罗占卜师Luna

用户今日信息：
- 内在状态：[用户选择的情绪]
- 今日塔罗牌：[牌名]
- 今日月相：[月相名称，能量描述]

请生成以下内容：
1. 一句综合指引（40汉字以内，不涉及具体领域）
2. 2项具体占卜（从情感/工作/学习/生活/家庭中选择，每项80汉字以内）
3. 5个分类的详细占卜（每个分类60汉字以内）
4. 今日幸运元素：幸运色、饰品、幸运数字、摆件
5. 今日疗愈任务（一个具体的微任务，20秒-2分钟可完成）
```

### 输出数据结构

```dart
class DailyReading {
  // 基础信息
  String tarotCard;
  String moonPhase;
  String userEmotion;
  
  // LLM生成内容
  String guidanceOneLine;        // 40字以内
  List<CategoryGuidance> twoItems;  // 2项，各80字
  Map<String, String> categoryGuidance;  // 5个分类，各60字
  LuckyElements luckyElements;    // 幸运元素
  String healingTask;             // 疗愈任务
  
  // 元数据
  DateTime date;
  bool taskCompleted;
}
```

---

## 🎨 视觉设计要点

### 整体风格
- **温柔治愈**：柔和的色彩、圆润的线条
- **仪式感**：抽牌动画、过渡效果
- **简洁优雅**：避免信息过载
- **专注**：全屏占卜页面不受干扰

### 色彩方案
- 主色调：柔和的紫色、蓝色、粉色
- 背景：浅色或渐变
- 卡片：白色/浅色卡片，带阴影

### 字体
- 标题：较大、易读
- 正文：清晰、行距适中
- 支持中英文

### 动画
- 抽牌动画：流畅、有仪式感
- 翻牌动画：3D翻转效果
- 页面过渡：柔和、不突兀
- 完成按钮：反馈动画

---

## 📱 响应式设计

### 屏幕适配
- 支持不同屏幕尺寸
- 内容自适应布局
- 确保关键信息可见

### 横竖屏
- 主要支持竖屏
- 横屏可以显示更多内容（可选）

---

## ⏱️ 性能优化

### 数据预加载
- 月相数据：本地计算，无需网络
- 塔罗牌图片：本地资源或缓存
- LLM 结果：可以缓存，避免重复请求

### 加载状态
- 显示加载动画
- 网络请求失败时的错误处理
- 离线模式支持（显示已生成的内容）

---

## 🔔 交互细节

### 手势支持
- 滑动返回
- 长按抽牌
- 点击交互

### 反馈
- 按钮点击反馈
- 完成任务反馈
- 加载状态反馈

---

## 📝 待确认问题

详见下方"疑问清单"章节。

