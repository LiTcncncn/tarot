# 星座星盘分析功能方案

## 一、功能概述

在"今日主界面"的"查看各领域指引"模块下方，添加两个并排按钮：
1. **每日星座** - 基于用户星座的每日指引
2. **星盘分析** - 基于用户完整星盘信息的深度分析

## 二、UI设计

### 2.1 按钮位置
- 位置：在"查看各领域指引"模块下方
- 布局：两个按钮并排显示（横向排列）
- 样式：与现有按钮风格保持一致

### 2.2 按钮设计

#### 每日星座按钮
- **图标显示逻辑**：
  - 如果用户已填写出生日期（有星座信息）：显示对应的12星座图标（♈♉♊♋♌♍♎♏♐♑♒♓）
  - 如果用户未填写出生日期：显示默认星座图标（✨）
- **按钮文字**：每日星座
- **按钮样式**：与现有分类按钮风格一致

#### 星盘分析按钮
- **图标**：星盘图标（🔮）
- **按钮文字**：星盘分析
- **按钮样式**：与现有分类按钮风格一致

### 2.3 响应式设计
- 移动端：两个按钮并排，各占50%宽度
- 桌面端：两个按钮并排，适当间距

## 三、功能逻辑

### 3.1 每日星座功能

#### 信息要求
- **必需信息**：出生日期（年月日）
- **信息获取**：从用户个人信息中读取（`userProfile.birthday`）

#### 点击逻辑
1. **检查信息完整性**：
   - 如果用户已填写出生日期 → 进入生成分析界面
   - 如果用户未填写出生日期 → 进入补充信息界面（跳转到个人信息补充流程的生日步骤）

2. **生成分析界面**：
   - 显示加载状态
   - 调用API生成星座分析内容
   - 显示分析结果

#### 内容生成
- **Prompt要求**：
  - 解读用户星座的今日能量
  - 参考今日塔罗牌、月相、用户当前情绪状态
  - 以疗愈为目的，生成温暖、治愈、正向情绪指引
  - 文字中包含用户昵称（如："亲爱的[昵称]"或"[昵称]，今天..."）

### 3.2 星盘分析功能

#### 信息要求
- **必需信息**：
  1. 出生日期（年月日）
  2. 出生时间（小时，可选但推荐）
  3. 出生地点（城市，可选但推荐）

#### 点击逻辑
1. **检查信息完整性**：
   - 如果用户已填写出生日期、出生时间、出生地点（三项必须齐全）→ 进入生成分析界面
   - 如果信息不完整 → 直接打开个人信息补充模态框（跳转到个人信息补充流程）

2. **生成分析界面**：
   - 显示加载状态
   - 调用API生成星盘分析内容
   - 显示分析结果

#### 内容生成
- **Prompt要求**：
  - 解读用户星盘的今日能量
  - 参考今日塔罗牌、月相、用户当前情绪状态
  - 以疗愈为目的，生成温暖、治愈、正向情绪指引
  - 文字中包含用户昵称

## 四、技术实现

### 4.1 数据获取
- 从 `userProfile` 中读取：
  - `birthday` - 出生日期
  - `birthTime` - 出生时间（小时）
  - `birthplace` - 出生地点（城市）
  - `zodiac` - 星座（如果有，可直接使用；如果没有，从生日计算）

### 4.2 API调用
- **每日星座API**：
  - 输入：用户星座、今日塔罗牌、月相、用户情绪状态、用户昵称
  - 输出：星座分析文本

- **星盘分析API**：
  - 输入：出生日期、出生时间、出生地点、今日塔罗牌、月相、用户情绪状态、用户昵称
  - 输出：星盘分析文本

### 4.3 界面跳转
- **补充信息界面**：
  - 跳转到个人信息补充模态框
  - 自动定位到缺失信息的步骤
  - 完成补充后，返回并重新检查信息完整性

- **生成分析界面**：
  - 显示加载动画
  - 调用API
  - 显示分析结果（类似"今日分析"的展示方式）

## 五、Prompt设计

### 5.1 每日星座Prompt模板

```
请基于以下信息，生成今日星座指引：

【用户信息】
- 昵称：[用户昵称]
- 星座：[星座名称] [星座emoji]

【今日能量】
- 塔罗牌：[塔罗牌名称] - [塔罗牌含义]
- 月相：[月相名称] [月相emoji] - [月相能量]
- 情绪状态：[用户当前情绪状态]

【要求】
1. 解读[星座名称]今日的能量和特质
2. 结合今日塔罗牌和月相能量，给出个性化指引
3. 以疗愈为目的，生成温暖、治愈、正向情绪指引
4. 文字中自然融入用户昵称，如"亲爱的[昵称]"或"[昵称]，今天..."
5. **字数严格控制在200-250字之间**（必须在此范围内）
6. 语调温柔、亲切、充满关怀
7. 避免负面暗示，强调成长和可能性
8. 不要提及"逆位/正位"等牌面方向相关词汇
9. 不要描述抽牌过程

请生成今日星座指引（200-250字）：
```

### 5.2 星盘分析Prompt模板

```
请基于以下信息，生成今日星盘分析：

【用户信息】
- 昵称：[用户昵称]
- 出生日期：[年月日]
- 出生时间：[小时]
- 出生地点：[城市]
- 星座：[星座名称] [星座emoji]

【今日能量】
- 塔罗牌：[塔罗牌名称] - [塔罗牌含义]
- 月相：[月相名称] [月相emoji] - [月相能量]
- 情绪状态：[用户当前情绪状态]

【要求】
1. 基于用户星盘信息（出生日期、时间、地点），解读今日的星象能量
2. 结合今日塔罗牌和月相能量，给出深度个性化指引
3. 以疗愈为目的，生成温暖、治愈、正向情绪指引
4. 文字中自然融入用户昵称，如"亲爱的[昵称]"或"[昵称]，今天..."
5. **字数严格控制在300-400字之间**（必须在此范围内）
6. 语调温柔、亲切、充满关怀
7. 避免负面暗示，强调成长和可能性
8. 不要提及"逆位/正位"等牌面方向相关词汇
9. 不要描述抽牌过程
10. 可以提及星盘中的关键相位或行星位置，但要保持温暖治愈的语调

请生成今日星盘分析（300-400字）：
```

## 六、界面展示

### 6.1 分析结果展示
- **布局**：类似"今日分析"的展示方式
- **内容**：
  - 标题：每日星座 / 星盘分析
  - 内容：生成的指引文本
  - 样式：温暖、治愈的视觉风格

### 6.2 加载状态
- 显示加载动画
- 提示文字："正在为你生成专属指引..."

## 七、待确认问题

### 7.1 功能相关
1. **星座图标**：
   - 是否需要为12个星座分别准备图标？
   - 还是使用统一的星座图标（如✨）？
   - 如果使用统一图标，是否需要根据星座显示不同颜色？

2. **星盘图标**：
   - 使用emoji（如🔮、⭐）还是自定义图标？
   - 如果需要自定义图标，是否有设计稿？

3. **信息完整性判断**：
   - 星盘分析中，出生时间和出生地点是否必须？
   - 如果只有出生日期，是否可以生成简化版星盘分析？
   - 还是必须三项都齐全才能使用星盘分析功能？

4. **跳转逻辑**：
   - 如果信息不完整，跳转到个人信息补充界面时：
     - 是否直接打开个人信息模态框？
     - 是否自动定位到缺失信息的步骤？
     - 补充完成后，是否自动返回并重新检查？

5. **内容生成**：
   - 每日星座和星盘分析的内容格式是否一致？
   - 是否需要区分不同的展示样式？
   - 内容是否需要支持多段显示？

6. **缓存机制**：
   - 每日星座和星盘分析需要缓存
   - 如果用户在同一天多次点击，显示缓存内容，不重新生成
   - 缓存键：`zodiac_analysis_${dateKey}` 和 `horoscope_analysis_${dateKey}`

7. **错误处理**：
   - 如果API调用失败，如何提示用户？
   - 是否需要重试机制？

### 7.2 UI相关
1. **按钮位置**：
   - "查看各领域指引"模块下方，是否需要与模块有间距？
   - 是否需要标题或说明文字？

2. **按钮样式**：
   - 是否需要与"查看各领域指引"的分类按钮样式完全一致？
   - 还是需要有所区别（如更大、更突出）？

3. **响应式**：
   - 移动端两个按钮并排，是否需要考虑文字换行？
   - 桌面端是否需要限制按钮最大宽度？

4. **图标显示**：
   - 星座图标的大小和位置？
   - 是否需要图标+文字的布局？

### 7.3 技术相关
1. **API集成**：
   - 星盘分析仅基于用户输入的日期、时间、地点，由LLM生成分析
   - 不需要调用外部星盘API或集成星盘计算库
   - LLM会根据提供的日期、时间、地点信息，结合今日塔罗、月相、情绪状态生成分析

3. **数据存储**：
   - 生成的星座/星盘分析是否需要保存到本地存储？
   - 如果需要，存储结构如何设计？

4. **性能优化**：
   - API调用是否需要防抖处理？
   - 是否需要预加载或缓存机制？

## 八、实施步骤

### 阶段一：UI实现
1. 在"查看各领域指引"模块下方添加两个按钮
2. 实现按钮样式和响应式布局
3. 实现图标显示逻辑（星座图标根据用户信息动态显示）

### 阶段二：信息检查逻辑
1. 实现信息完整性检查函数
2. 实现跳转到个人信息补充界面的逻辑
3. 实现自动定位到缺失信息步骤的功能

### 阶段三：内容生成
1. 实现API调用函数
2. 实现Prompt构建逻辑
3. 实现内容展示界面

### 阶段四：优化和测试
1. 优化加载状态和错误处理
2. 测试各种信息完整性场景
3. 优化用户体验

## 九、注意事项

1. **用户体验**：
   - 信息不完整时，跳转要流畅自然
   - 补充信息后，要能自动返回并继续流程

2. **内容质量**：
   - 确保生成的内容温暖、治愈、正向
   - 避免负面暗示或恐吓性语言

3. **性能**：
   - API调用可能需要较长时间，要做好加载状态提示
   - 考虑添加超时处理和重试机制

4. **一致性**：
   - 与现有功能（如"今日分析"）保持风格一致
   - 使用相同的设计语言和交互模式

