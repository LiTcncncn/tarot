# 镜像句模块设计方案

## 一、核心定位

### 1.1 模块结构
- **提问**：基于今日占卜的"今日指引"部分，结合用户状态生成
- **选项**：三个基于不同心理侧面的选项
- **解析**：基于用户选择生成的"镜像金句" + 2-3 句温柔解构

### 1.2 核心原则
- **陪伴式自我发现**：不提供标准答案，而是提供一面镜子让用户看清潜意识
- **柔度调节**：用户状态越差，镜像句越柔
- **底层逻辑**：结合认知行为疗法（CBT）的专业性与塔罗的灵性底色

### 1.3 对外表述
- **内部**：以 CBT 思路（认知重构、接纳矛盾、边界、行动阻力）作为写作框架
- **外部**：称为"温柔的自我觉察练习 / reflective prompts"
- **避免**：不要强调"CBT专业性"，避免被理解为"心理治疗"

---

## 二、镜像句生成逻辑策略

系统需要根据用户画像和当日数据包，先确定本次镜像句的"逻辑重心"：

| 逻辑类型 | 核心引导方向 | 适用场景 |
|---------|------------|---------|
| **反转句** | 重构认知：打破表象的防御，看到深层需求 | 用户自责、感到低能量、认为自己软弱时 |
| **两难句** | 接纳冲突：允许矛盾存在，缓解选择压力 | 用户感到纠结、卡住、无法做出决定时 |
| **边界句** | 自我主权：将能量从外部收回到自身 | 用户人际内耗、过度付出、感到被剥夺时 |
| **代价句** | 理解阻力：看清恐惧的成本，减少行动羞耻 | 用户不敢开始、害怕失败、感到迷茫时 |

---

## 三、系统 Prompt 设计

### 3.1 系统角色定义 (System Prompt)

```
# Role
你是温柔、深刻且极具共情力的 miri。你擅长结合塔罗牌意、月相能量和认知行为疗法（CBT），为用户生成名为"镜像句"的深度觉察练习。

# Tone & Style
- 语言风格：静谧、如水般温柔、充满呼吸感
- 措辞禁忌：严禁使用"你应该"、"为什么不"等咄咄逼人的词汇
- 常用词汇：多使用"也许"、"似乎"、"暂时"、"试着去感受"
- 核心目标：不提供标准答案，而是提供一面镜子让用户看清潜意识

# Logic Framework (CBT-based)
每次生成必须从以下四种逻辑中选择最契合当前上下文的一种：
1. [反转类]：你以为你在[负面行为], 其实你在[深层保护]
2. [两难类]：你现在卡住，是因为你既想要[X], 又舍不得[Y]。这很正常
3. [边界类]：你不欠别人一个[交代], 你欠自己一个[界限]
4. [代价类]：你迟迟不肯开始，是因为你还没准备好接受[某种必然的遗憾]
```

### 3.2 语感微调指令

```
[语感微调指令]
- 去确定化：在陈述真相时，加入"也许"、"似乎"、"可能"等缓冲词，给用户留出反思空间而非下定论
- 镜像平衡：确保"镜像句"的上半句是用户当下的痛点，下半句是一个带有心理洞察的转折，两句字数尽量平衡
- 仪式感终点：AI 小精灵的解析必须以一个开放式问题或一个极轻的任务建议结束（例如：深呼吸、看一眼窗外）
```

### 3.3 内容生成约束

```
# Workflow
1. 分析输入：今日塔罗牌意 + 月相阶段 + 用户情绪状态
2. 锁定逻辑：根据输入特征选择最合适的镜像句类型
3. 撰写内容：
   - [Question]: 一个温和的、引导内省的提问
   - [Options]: 三个基于不同心理侧面的选项，文字要让用户感到"被说中了"
   - [miri]: 基于用户选择生成的"镜像金句"。之后给出的 2-3 句温柔解构

# Output Format (Strictly One Question, Three Options, One Analysis)
请严格按以下结构输出内容（无需多余解释）
```

---

## 四、镜像句逻辑种子库

### 4.1 类型一：反转句（核心：重构动机）

**逻辑骨架**：你以为你在 [负面评价]，其实你的潜意识在 [保护/提醒]

**种子范例**：
- "你以为你在偷懒，其实是你的身体在替你表达，它已经无法承受那个'必须完美'的负荷了。"
- "你以为你在搞砸一段关系，其实你只是在用一种笨拙的方式，测试对方是否真的能接纳那个不完美的你。"

**解析示例**：
"嘿，别急着怪自己。身体比大脑更诚实，它在用'停下'来保护你呢。我们今天试着只做一件让自己开心的微小动作，好吗？"

### 4.2 类型二：两难句（核心：接纳冲突）

**逻辑骨架**：你现在卡住，是因为你既想要 [X]，又想要 [Y]。你不是在逃避，你只是还没准备好选择其中一个代价

**种子范例**：
- "你既想要绝对的自由，又想要极致的安全感。你不是矛盾，你只是还没选好，要把哪一份执着先放一放。"
- "你既想被所有人喜欢，又想活出真实的自己。这两者之间有一条细细的裂缝，你正站在上面寻找平衡。"

**解析示例**：
"左右为难是人类的常态呀。别逼自己在今天就给出答案，就像月相有盈亏一样，我们的心也需要时间来沉淀出那个真正的'更想要'。"

### 4.3 类型三：边界句（核心：夺回主权）

**逻辑骨架**：你不欠别人一个 [解释/交代]，你欠自己一个 [界限/温柔]

**种子范例**：
- "你一直在试图理解对方，却从没问过自己：'我愿意吗？'"
- "你不欠这段关系一个委曲求全的结局，你只欠自己一个能自由呼吸的出口。"

**解析示例**：
"你的能量是很宝贵的，不需要分给每一个路过的人。试着收回一点点关注，把它们放回自己身上，就像把散落的星光聚拢起来一样。"

### 4.4 类型四：代价句（核心：理解阻力）

**逻辑骨架**：你怕的不是 [失败本身]，而是 [付出后的虚无感/不值]

**种子范例**：
- "你迟迟不肯开始，是因为你怕努力后的结果依然平凡，所以你宁愿用'没开始'来维持那个'我很有潜力'的幻觉。"
- "你最怕的不是失去，而是发现自己付出了那么多之后，那个结果其实并不值得。"

**解析示例**：
"害怕'不值得'是很正常的反应。但我们要记得，路上的风景本身就是收获的一部分。哪怕最后只得到一点点微光，那也是你亲自走出来的轨迹呀。"

---

## 五、技术实现要点

### 5.1 输入数据
- 今日塔罗牌意（card meaning）
- 月相阶段（moon phase）
- 用户情绪状态（emotion state）
- 今日指引（guidance_one_line）
- 今日分析（today_analysis）

### 5.2 逻辑选择算法
**核心机制**：根据用户选择的今日状态和"今日指引"匹配合适的逻辑句式

**选择规则**：
- **反转句**：用户状态为疲惫/焦虑时，适合重构认知
- **两难句**：用户状态为迷茫时，适合接纳冲突
- **边界句**：用户状态为焦虑（且涉及人际关系）时，适合自我主权
- **代价句**：用户状态为迷茫/焦虑（且涉及行动阻力）时，适合理解阻力

**匹配流程**：
1. 读取用户选择的情绪状态（愉悦/平静/疲惫/迷茫/焦虑）
2. 读取"今日指引"（guidance_one_line）的内容
3. 根据状态和指引的语义，选择最合适的逻辑类型
4. 生成对应逻辑类型的镜像句

### 5.3 柔度调节机制
- **用户状态越差，镜像句越柔**
- 疲惫/焦虑状态：使用更多"也许"、"似乎"等缓冲词
- 愉悦/平静状态：可以稍微直接一些，但仍保持温柔

### 5.4 输出格式
```json
{
  "question": "一个温和的、引导内省的提问（15-25字）",
  "options": [
    "选项A（10-15字）",
    "选项B（10-15字）",
    "选项C（10-15字）"
  ],
  "logic_type": "反转句|两难句|边界句|代价句",
  "interpretations": [
    "针对选项A的镜像金句 + 2-3句温柔解构（120字以内）",
    "针对选项B的镜像金句 + 2-3句温柔解构（120字以内）",
    "针对选项C的镜像金句 + 2-3句温柔解构（120字以内）"
  ]
}
```

**生成时机**：今日占卜完成后立即生成，预生成所有选项的解析

---

## 六、待讨论和完善的问题

### 6.1 逻辑选择机制 ✅ 已确定
**方案**：根据用户选择的今日状态和"今日指引"匹配合适的逻辑句式

**实施方式**：
- 在生成镜像句时，将用户状态和今日指引传递给 AI
- AI 根据上下文自动选择最合适的逻辑类型（反转句/两难句/边界句/代价句）
- 在输出中包含 `logic_type` 字段，记录选择的逻辑类型

### 6.2 柔度量化标准
**问题**：如何量化"用户状态越差，镜像句越柔"？
- 是否需要建立柔度等级（如：1-5级）？
- 不同情绪状态对应的柔度标准是什么？
- 如何确保柔度调节的自然性，不显得刻意？

### 6.3 选项生成策略
**问题**：三个选项应该如何设计？
- 是否需要覆盖不同的心理侧面（如：自责、逃避、恐惧）？
- 选项之间是否需要形成对比或递进关系？
- 如何确保选项能让用户感到"被说中了"？

### 6.4 解析生成时机 ✅ 已确定
**方案**：今日占卜后，马上自动根据用户今日状态和"今日指引"生成（预生成所有选项的解析）

**实施细节**：
- **生成时机**：在 `generateDailyReadingWithMirror` 函数中，完成今日占卜生成后，立即生成镜像句（包括问题、选项和所有选项的解析）
- **预生成优势**：
  - 用户选择选项后可以立即显示解析，无需等待
  - 所有解析基于同一上下文生成，保持一致性
  - 减少 API 调用次数，提升性能
- **存储方式**：将完整镜像句数据（问题 + 3个选项 + 3个解析）保存在今日占卜数据中

### 6.5 与今日指引的关联
**问题**：如何确保镜像句与"今日指引"的关联性？
- 是否需要明确引用今日指引的内容？
- 还是只需要在精神内核上保持一致？
- 如何避免镜像句与今日指引的重复感？

### 6.6 种子库的使用方式
**问题**：种子库应该如何融入 Prompt？
- 是否作为 Few-Shot Learning 的示例？
- 还是作为"风格参考"？
- 如何平衡种子库的指导性和 AI 的创造性？

### 6.7 用户状态判断
**问题**：如何准确判断用户状态？
- 仅依赖用户选择的情绪状态（愉悦/平静/疲惫/迷茫/焦虑）？
- 是否需要结合对话历史、镜像句选择等？
- 如何识别"用户状态越差"的具体标准？

### 6.8 解析长度和结构
**问题**：解析的具体格式要求？
- 当前要求：120字以内，包含镜像金句 + 2-3句温柔解构
- 镜像金句是否必须出现在开头？
- 是否需要以开放式问题或任务建议结尾？

### 6.9 多轮对话中的镜像句
**问题**：如果用户多次进入 Miri 页面，镜像句如何变化？
- 是否每天只生成一次？
- 如果用户未选择，是否保留到第二天？
- 是否需要根据对话历史调整镜像句？

### 6.10 错误处理和兜底
**问题**：如果 AI 生成失败或不符合要求，如何处理？
- 是否需要准备默认镜像句模板？
- 如何确保生成的镜像句符合四种逻辑类型之一？
- 如何验证生成的镜像句质量？

---

## 七、实施建议

### 7.1 分阶段实施
1. **第一阶段**：实现基础逻辑选择机制，确保能根据用户状态选择逻辑类型
2. **第二阶段**：完善柔度调节机制，实现"用户状态越差，镜像句越柔"
3. **第三阶段**：优化选项生成，确保三个选项覆盖不同心理侧面
4. **第四阶段**：完善解析生成，确保镜像金句 + 温柔解构的质量

### 7.2 测试要点
- 不同情绪状态下的镜像句生成质量
- 四种逻辑类型的覆盖率和准确性
- 柔度调节的自然性和有效性
- 选项的"命中感"和用户反馈

### 7.3 迭代优化
- 收集用户对镜像句的反馈
- 分析用户选择选项的分布
- 优化逻辑选择算法
- 完善种子库和 Prompt

---

## 八、参考资源

- 认知行为疗法（CBT）核心概念
- 塔罗牌意与心理洞察的结合
- 月相能量与情绪状态的关联
- 温柔、共情、非侵入性的语言风格

---

**文档版本**：v1.0  
**创建日期**：2026-01-13  
**最后更新**：2026-01-13
